<!DOCTYPE html>
<html class="jf-inactive">

<head>
  <!-- <title>Google Sheets API Quickstart</title> -->
  <title>資安闖天關刷題 - 2022 GiCS 尋找資安女婕思 - 中興大學資訊社</title>
  <meta name="description" content="請用電腦打開">
  <meta property="og:image"
    content="https://stickershop.line-scdn.net/stickershop/v1/sticker/166501723/android/sticker.png">
  <meta charset="utf-8" />
  <style data-merge-styles="true"></style>
  <link rel="stylesheet"
    href="//d32j6uwsrra4gx.cloudfront.net/assets/application-3c64c6e5cc4b783d9b350e8ab1892881e621ebc2338250bf6dc2cdf9e457ff05.css">
  <link rel="stylesheet" href="//d32j6uwsrra4gx.cloudfront.net/packs/css/map_components-c00cef7a.chunk.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
  <style>
    * {
      user-select: text !important
    }
  </style>
</head>

<body lang="zh-TW" ctheme c-culture class="unselectable ReactModal__Body--open" style="overscroll-behavior: none;"
  theme="ocean" onclick="toggleMute(); toggleMute(); new Audio('panel_btn_click_sound_effect.mp3').play();">
  <div class="ui top fixed menu">
    <div class="item">
      <img src="//i.imgur.com/6LcYa68.png">
    </div>
    <div class="item">
      <!-- <p>Google Sheets API Quickstart</p> -->
      <h1 class="ui header">資安闖天關刷題 - 2022 GiCS 尋找資安女婕思</h1>
    </div>
    <div class="right menu">
      <div id="audio_container" class="pgo-style-audios-29lfQn">
        <audio id="map_background_music" loop src="map_background_music.mp3" type="audio/mpeg"
          controlslist="nodownload">Your browser does not support the audio tag.</audio>
        <audio id="fight_background_music" loop src="fight_background_music.mp3" type="audio/mpeg"
          controlslist="nodownload">Your browser does not support the audio tag.</audio>
        <audio id="victory_sound_effect" src="victory_sound_effect.mp3" type="audio/mpeg" controlslist="nodownload">Your
          browser does not support the audio tag.</audio>
        <audio id="keep_going_sound_effect" src="keep_going_sound_effect.mp3" type="audio/mpeg"
          controlslist="nodownload">Your browser does not support the audio tag.</audio>
        <audio id="panel_btn_click_sound_effect" src="panel_btn_click_sound_effect.mp3" type="audio/mpeg"
          controlslist="nodownload">Your browser does not support the audio tag.</audio>
      </div>
      <div id="volctrl" class="item ui header">
        <i class="volume off icon"></i>
      </div>
      <!--Add buttons to initiate auth sequence and sign out-->
      <button class="positive ui button" id="authorize_button" style="display: none;">
        <h5>登入 Google 帳號</h5>
      </button>
      <button class="negative ui button" id="signout_button" style="display: none;">
        <h5>登出 Google 帳號</h5>
      </button>
      <button class="ui button" id="signloader_button">
        <div class="ui active inline loader"></div>
        <h5 style="display:inline">正在載入中</h5>
      </button>
    </div>
  </div>
  <div style="height:50px"></div>
  <div class="ui inverted segment">
    <div class="ui active dimmer" id="loader">
      <div class="ui massive text loader">題目載入中</div>
    </div>
    <div id="answer-panel" class="attack_modal_reading_sprite panel ui container">
      <form class="ui form" id="form" method="POST" target="transFrame"
        action="https://docs.google.com/forms/u/1/d/e/1FAIpQLSc8J8l55WOGCbYfQlc3vA6sr-6TD7pPsFioW_bZCaTTVOjnWA/formResponse">
        <div id='clear' class="attack_modal_sprite btn_exit cursor_pointer pgo-style-exit-button-1-aQN0"
          data-tooltip="清除輸入" data-position="bottom right" data-extended-answer-panel="false"></div>
        <div class="pgo-style-clock-1JHy5B">
          <div class="pgo-style-clock-number-2-E3v-">?</div>
          <div class="pgo-style-clock-number-2-E3v-">?</div>
          <div class="pgo-style-clock-number-2-E3v-">?</div>
          <div class="pgo-style-clock-number-2-E3v-">?</div>
          <div class="pgo-style-clock-number-2-E3v-">?</div>
          <div class="pgo-style-clock-number-2-E3v-">?</div>
        </div>
        <div class="pgo-style-question-area-2If0h0" data-question-type="choice" data-input-type="choice"
          data-with-sponsor-and-hint="false" data-exam-mode="false">
          <div id="answer-panel-question-with-input">
            <div class="answer-panel-question-content" data-self-control="false" data-with-sponsor-and-hint="false"
              data-input-type="choice" data-show-detail="false" data-exam-mode="false">
              <div class="question-iframe-container pgo-style-question-content-1iaDNm" data-inverted
                data-tooltip="貼上時若符合格式將附有切分至答案的功能" data-position="bottom center">
                <textarea rows="2" style="width:525px;border:0" class="pgo-style-question-content-wrapper-vTwh8z"
                  form="form" name="entry.892031688">
                題目載入中
            </textarea>
              </div>
              <div class="pgo-style-question-selections-TbE9eE">
                <div class="question-iframe-container pgo-style-selection-13WO94 ui grid" data-org-position="A">
                  <div class="one wide column">
                    <div class="pgo-style-selection-choice-rrQTIw">A</div>
                  </div>
                  <div class="fifteen wide column">
                    <textarea rows="1" style="width:500px;border:0" spellcheck="false" data-ms-editor="true"
                      class="pgo-style-selection-content-1JGhEL" form="form" name="entry.977089316">
                  題目載入中
                </textarea>
                  </div>
                </div>
                <div class="question-iframe-container pgo-style-selection-13WO94 ui grid" data-org-position="B">
                  <div class="one wide column">
                    <div class="pgo-style-selection-choice-rrQTIw">B</div>
                  </div>
                  <div class="fifteen wide column">
                    <textarea rows="1" style="width:500px;border:0" spellcheck="false" data-ms-editor="true"
                      class="pgo-style-selection-content-1JGhEL" form="form" name="entry.657500498">
                  題目載入中
                </textarea>
                  </div>
                </div>
                <div class="question-iframe-container pgo-style-selection-13WO94 ui grid" data-org-position="C">
                  <div class="one wide column">
                    <div class="pgo-style-selection-choice-rrQTIw">C</div>
                  </div>
                  <div class="fifteen wide column">
                    <textarea rows="1" style="width:500px;border:0" spellcheck="false" data-ms-editor="true"
                      class="pgo-style-selection-content-1JGhEL" form="form" name="entry.1532072947">
                  題目載入中
                </textarea>
                  </div>
                </div>
                <div class="question-iframe-container pgo-style-selection-13WO94 ui grid" data-org-position="D">
                  <div class="one wide column">
                    <div class="pgo-style-selection-choice-rrQTIw">D</div>
                  </div>
                  <div class="fifteen wide column">
                    <textarea rows="1" style="width:500px;border:0" spellcheck="false" data-ms-editor="true"
                      class="pgo-style-selection-content-1JGhEL" form="form" name="entry.1090409630">
                  題目載入中
                </textarea>
                  </div>
                </div>
              </div>
            </div>
            <div data-question-type="choice" data-selection-count="5" data-exam-mode="false"
              class="input-group-area pgo-style-inputs-area-2w2qDZ">
              <div class="cursor_pointer choice-button attack_modal_sprite btn_4a1 pgo-style-input-answer-2o3iYm"
                data-real-choice="A" id="buttonA">A</div>
              <div class="cursor_pointer choice-button attack_modal_sprite btn_4a1 pgo-style-input-answer-2o3iYm"
                data-real-choice="B" id="buttonB">B</div>
              <div class="cursor_pointer choice-button attack_modal_sprite btn_4a1 pgo-style-input-answer-2o3iYm"
                data-real-choice="C" id="buttonC">C</div>
              <div class="cursor_pointer choice-button attack_modal_sprite btn_4a1 pgo-style-input-answer-2o3iYm"
                data-real-choice="D" id="buttonD">D</div>
              <div class="cursor_pointer general2_sprite btn04 pgo-style-submit-button-30KwXW"
                data-position="bottom right" data-tooltip="請確保送出時 A 選項為正確答案，本表單會自動匯入 Google 試算表" id="submit">送出</div>
            </div>
          </div>
        </div>
        <a href="//docs.google.com/spreadsheets/d/1mLuYzFZp-zuLn1w8OMAo9XT99kzyMYVd3Zq299FYNlw" target="_blank"
          title="查看 Google 試算表">
          <div class="attack_modal_reading_sprite error_report_S cursor_pointer pgo-style-error-report-button-1RQaWX"
            onclick="$('.ui.modal').modal('show');">
          </div>
        </a>
        <div class="ui mini modal">
          <div class="header">流程說明製作中...</div>
          <div class="content">
            <p></p>
            <p></p>
            <p></p>
          </div>
        </div>
        <div class="pgo-style-submit-button-pASHWz" data-extended-answer-panel="false">
          <div id="nextQuestion" class="cursor_pointer general2_sprite btn04 pgo-style-submit-button-30KwXW">
            下一題</div>
        </div>
      </form>
    </div>
  </div>
  <pre id="content" class="ui container" style="white-space:pre-wrap;font-size:large">👉狀態欄/目前題庫<br></pre>
  <iframe name="transFrame" id="transFrame" tabindex="-1" aria-hidden="true"
    style="width:1px;height:1px;position:absolute;top:-100px;display:none"></iframe>
  <div class="ui inverted vertical footer segment">
    <div class="ui center aligned container">
      <div class="ui stackable grid">
        <div class="column">
          <div class="ui inverted link list" data-tooltip="點我看組織章程">
            <a class="item" href="//ppt.cc/fA9uAx" target="_blank">© 2022 NCHUIT, Club</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script charset="utf-8" src="//code.jquery.com/jquery-3.6.0.min.js"></script>
  <script charset="utf-8" src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <script type="text/javascript">
    const entry = {
      題目: 'entry.892031688',
      正確答案: 'entry.977089316',
      錯誤答案1: 'entry.657500498',
      錯誤答案2: 'entry.1532072947',
      錯誤答案3: 'entry.1090409630'
    }

    // Client ID and API key from the Developer Console
    var CLIENT_ID = '289902636224-oro06s681gdgk1kqrv8o1oca2shocfr4.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyCRfe3-dnm9GGMH_PFm9m5WHBMb_8U9HXY';

    // Array of API discovery doc URLs for APIs used by the quickstart
    var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

    var signloaderbutton = document.getElementById('signloader_button');
    var authorizeButton = document.getElementById('authorize_button');
    var signoutButton = document.getElementById('signout_button');
    var nextQuestion = document.getElementById('nextQuestion');
    var buttonA = document.getElementById('buttonA');
    var buttonB = document.getElementById('buttonB');
    var buttonC = document.getElementById('buttonC');
    var buttonD = document.getElementById('buttonD');
    var loader = document.getElementById('loader');
    var submit = document.getElementById('submit');
    var clean = document.getElementById('clear');
    var pre = document.getElementById('content');
    var 題目 = document.forms[0][entry.題目];
    var 選項 = [
      document.forms[0][entry.正確答案],
      document.forms[0][entry.錯誤答案1],
      document.forms[0][entry.錯誤答案2],
      document.forms[0][entry.錯誤答案3]
    ];

    var data = [], database;
    var current, correct;

    var bgm = new Audio('map_background_music.mp3');
    bgm.loop = true;


    // From https://stackoverflow.com/questions/951021/what-is-the-javascript-version-of-sleep
    const sleep = ms => new Promise(r => setTimeout(r, ms));

    /**
     * From https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
     */
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let t = array[i];
        array[i] = array[j];
        array[j] = t;
      }
      console.log(array);
      return array;
    }

    function newQuestion() {
      loader.style.display = 'flex';
      submit.style.display = 'none';
      current = data.pop();
      if (data.length < 1) loadDatabase();
      題目.innerHTML = current[0];
      current.splice(0, 1);
      correct = String(current[0]);
      current = shuffle(current);
      console.log(current);
      選項[0].innerHTML = current.pop();
      選項[1].innerHTML = current.pop();
      選項[2].innerHTML = current.pop();
      選項[3].innerHTML = current.pop();
      console.log(bgm.src);
      if (bgm.src.indexOf('fight_background_music.mp3') == -1)
        bgm.src = 'fight_background_music.mp3';
      bgm.play();
      loader.style.display = 'none';
    }

    /**
     * From https://developers.google.com/sheets/api/quickstart/js
     * Print the names and majors of students in a sample spreadsheet:
     * https://docs.google.com/spreadsheets/d/1mLuYzFZp-zuLn1w8OMAo9XT99kzyMYVd3Zq299FYNlw/edit
     */
    function loadDatabase() {
      loader.style.display = 'flex';
      cleanPre();
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '1mLuYzFZp-zuLn1w8OMAo9XT99kzyMYVd3Zq299FYNlw',
        range: '2022 GiCS!B2:F',
      }).then(function (response) {
        var range = response.result;
        if (range.values.length > 0) {
          database = data = range.values; shuffle(data);
          for (let row, i = 0; i < range.values.length; i++) {
            row = data[i];
            appendPre(
              '\n🤔' + row[0] + '\n⭕正確答案: ' + row[1] + '\n錯誤答案1: '
              + row[2] + '\n錯誤答案2: ' + row[3] + '\n錯誤答案3: ' + row[4]);
          }
          newQuestion();
        } else {
          appendPre('No data found.');
        }
      }, function (response) {
        appendPre('Error: ' + response.result.error.message);
      });
    }

    /**
     *  On load, called to load the auth2 library and API client library.
     */
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    /**
     *  Initializes the API client library and sets up sign-in state
     *  listeners.
     */
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      }, function (error) {
        appendPre(JSON.stringify(error, null, 2));
      });
    }

    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function updateSigninStatus(isSignedIn) {
      signloaderbutton.style.display = 'none';
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        loadDatabase();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
      }
    }


    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick(event) {
      loader.style.display = 'flex';
      signloaderbutton.style.display = 'block';
      authorizeButton.style.display = 'none';
      if (bgm.src.indexOf('map_background_music.mp3') == -1)
        bgm.src = 'map_background_music.mp3';
      bgm.play();
      gapi.auth2.getAuthInstance().signIn();
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick(event) {
      loader.style.display = 'flex';
      signloaderbutton.style.display = 'block';
      if (bgm.src.indexOf('map_background_music.mp3') == -1)
        bgm.src = 'map_background_music.mp3';
      bgm.play();
      gapi.auth2.getAuthInstance().signOut();
    }

    /**
     * Append a pre element to the body containing the given message
     * as its text node. Used to display the results of the API call.
     *
     * @param {string} message Text to be placed in pre element.
     */
    function appendPre(message) {
      pre.appendChild(document.createTextNode(message + '\n'));
    }

    function cleanPre() {
      document.getElementById('content').innerHTML = '👉狀態欄/目前題庫\n';
    }

    function checkQuestion(question) {
      for (const row of database)
        if (question && String(row[0]).indexOf(question) > -1) {
          alert("有這個題目了");
          return true;
        }
      // console.clear();
      // console.log(database);
      return false;
    }

    function toggleMute() {
      if (bgm.muted) {
        bgm.muted = false;
        document.getElementById("volctrl").innerHTML = `<i class="volume up icon"></i>`;
        document.body.onclick = () => {
          bgm.play();
          new Audio('panel_btn_click_sound_effect.mp3').play();
        }
      } else {
        bgm.muted = true;
        document.getElementById("volctrl").innerHTML = `<i class="volume off icon"></i>`;
        document.body.onclick = () => true;
      }
    }

    async function checkAns(選項) {
      if (correct === 選項.value) {
        new Audio('victory_sound_effect.mp3').play();
        await sleep(50);
        if (confirm('⭕答對啦！\n\n按下取消(Esc)返回、確定(Enter)下一題'))
          newQuestion();
      } else new Audio('keep_going_sound_effect.mp3').play();
    }

    authorizeButton.addEventListener("click", cleanPre);
    signoutButton.addEventListener("click", cleanPre);
    nextQuestion.addEventListener("click", newQuestion);
    buttonA.addEventListener('click', () => checkAns(選項[0]));
    buttonB.addEventListener('click', () => checkAns(選項[1]));
    buttonC.addEventListener('click', () => checkAns(選項[2]));
    buttonD.addEventListener('click', () => checkAns(選項[3]));

    clean.addEventListener("click", () => {
      for (input of document.forms[0])
        input.innerHTML = '';
    });

    submit.addEventListener("click", () => {
      for (const row of database)
        if (題目.value && String(row[0]).indexOf(題目.value) > -1) {
          alert("有這個題目了");
          return;
        }
      if (confirm(選項[0].value + '\n\n是正確答案嗎?\n\n按下確定(Enter)送至 Google 試算表'))
        document.forms[0].submit();
      submit.style.display = 'none';
    });


    題目.addEventListener("input", () => {
      let content = String(題目.value);
      let ai = content.indexOf('\nA\n');
      let bi = content.indexOf('\nB\n', ai);
      let ci = content.indexOf('\nC\n', bi);
      let di = content.indexOf('\nD\n', ci);
      console.log(ai, bi, ci, di);
      let ans = [
        content.substring(ai + 3, bi),
        content.substring(bi + 3, ci),
        content.substring(ci + 3, di),
        content.substring(di + 3)
      ];
      var question = 題目.value;
      if (ai > -1 && bi > -1 && ci > -1 && di > -1) {
        題目.value = content.substring(0, ai);
        question = 題目.value;
        if (!checkQuestion(question)) {
          let temp;
          const tip = "\n\n按下取消(Esc)選為錯誤答案、確定(Enter)選為正確答案";
          for (let i = -1; !confirm((temp = ans[++i]) + tip);)
            if (i == 2) { temp = ans[3]; break; }
          ans.splice(ans.indexOf(temp), 1);
          // console.log(ans);
          document.forms[0][entry.正確答案].value = temp;
          for (let i = 0; 4 > ++i; document.forms[0][entry[`錯誤答案${i}`]].value = ans[i - 1]);
          submit.style.display = 'block';
        }
      } else if (data.length > -1) {
        if (!checkQuestion(question) && 選項[0].value && 選項[1] && 選項[2] && 選項[3])
          submit.style.display = 'block';
      }
      console.log(`ai:${ai},bi:${bi},ci:${ci},di:${di}`);
    });

    document.getElementById("volctrl").addEventListener("click", toggleMute);

    題目.onfocus = () => {
      題目.select();
      // Work around Chrome's little problem
      題目.onmouseup = function () {
        // Prevent further mouseup intervention
        題目.onmouseup = null;
        return false;
      };
    };
  </script>
  <script async defer src="//apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if(this.readyState==='complete'){this.onload()}">
    </script>
</body>

</html>